import Foundation

//MARK: é§’ã®ã€Œä½ç½®ã€
//             ç‰
// 00,01,02,03,04,05,06,07,08
// 09,10,11,12,13,14,15,16,17
// ...
// 63,64,65,66,67,68,69,70,71
// 72,73,74,75,76,77,78,79,80
//             ç‹

struct å±€é¢ãƒ¢ãƒ‡ãƒ«: Codable {
    private(set) var ç›¤é§’: [Int: ç›¤ä¸Šã®é§’]
    private(set) var æ‰‹é§’: [ç‹å´ã‹ç‰å´ã‹: æŒã¡é§’]
    private(set) var ç›´è¿‘ã®æ“ä½œ: é§’ã®å ´æ‰€ = .ãªã—
    private(set) var æ›´æ–°æ—¥æ™‚: Date?
}

extension å±€é¢ãƒ¢ãƒ‡ãƒ« {
    mutating func é§’ã‚’ç§»å‹•ã•ã›ã‚‹(_ å‡ºç™ºã—ãŸå ´æ‰€: é§’ã®å ´æ‰€, _ ç§»å‹•å…ˆ: é§’ã®ç§»å‹•å…ˆãƒ‘ã‚¿ãƒ¼ãƒ³) throws {
        switch ç§»å‹•å…ˆ {
            case .ç›¤ä¸Š(let ç½®ã„ãŸä½ç½®):
                switch å‡ºç™ºã—ãŸå ´æ‰€ {
                    case .ç›¤é§’(let å‡ºç™ºä½ç½®):
                        if ç½®ã„ãŸä½ç½® == å‡ºç™ºä½ç½® { throw ğŸš¨é§’ç§»å‹•ã‚¨ãƒ©ãƒ¼.ç„¡åŠ¹ }
                        guard let å‹•ã‹ã—ãŸé§’ = self.ç›¤é§’[å‡ºç™ºä½ç½®] else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                        if let å…ˆå®¢ = self.ç›¤é§’[ç½®ã„ãŸä½ç½®] {
                            if å…ˆå®¢.é™£å–¶ == å‹•ã‹ã—ãŸé§’.é™£å–¶ { throw ğŸš¨é§’ç§»å‹•ã‚¨ãƒ©ãƒ¼.ç„¡åŠ¹ }
                            self.æ‰‹é§’[å‹•ã‹ã—ãŸé§’.é™£å–¶]?.ä¸€å€‹å¢—ã‚„ã™(å…ˆå®¢.è·å)
                        }
                        self.ç›¤é§’.removeValue(forKey: å‡ºç™ºä½ç½®)
                        self.ç›¤é§’.updateValue(å‹•ã‹ã—ãŸé§’, forKey: ç½®ã„ãŸä½ç½®)
                        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ç›¤é§’(ç½®ã„ãŸä½ç½®))
                    case .æ‰‹é§’(let é™£å–¶, let è·å):
                        if self.ç›¤é§’[ç½®ã„ãŸä½ç½®] != nil { throw ğŸš¨é§’ç§»å‹•ã‚¨ãƒ©ãƒ¼.ç„¡åŠ¹ }
                        self.ç›¤é§’.updateValue(ç›¤ä¸Šã®é§’(é™£å–¶, è·å), forKey: ç½®ã„ãŸä½ç½®)
                        self.æ‰‹é§’[é™£å–¶]?.ä¸€å€‹æ¸›ã‚‰ã™(è·å)
                        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ç›¤é§’(ç½®ã„ãŸä½ç½®))
                    default:
                        throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£
                }
            case .ç›¤å¤–(let ç§»å‹•å…ˆã®é™£å–¶):
                switch å‡ºç™ºã—ãŸå ´æ‰€ {
                    case .ç›¤é§’(let å‡ºç™ºåœ°ç‚¹):
                        guard let å‹•ã‹ã—ãŸé§’ = self.ç›¤é§’[å‡ºç™ºåœ°ç‚¹] else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                        self.ç›¤é§’.removeValue(forKey: å‡ºç™ºåœ°ç‚¹)
                        self.æ‰‹é§’[ç§»å‹•å…ˆã®é™£å–¶]?.ä¸€å€‹å¢—ã‚„ã™(å‹•ã‹ã—ãŸé§’.è·å)
                        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .æ‰‹é§’(ç§»å‹•å…ˆã®é™£å–¶, å‹•ã‹ã—ãŸé§’.è·å))
                    case .æ‰‹é§’(let ç§»å‹•å…ƒã®é™£å–¶, let è·å):
                        self.æ‰‹é§’[ç§»å‹•å…ƒã®é™£å–¶]?.ä¸€å€‹æ¸›ã‚‰ã™(è·å)
                        self.æ‰‹é§’[ç§»å‹•å…ˆã®é™£å–¶]?.ä¸€å€‹å¢—ã‚„ã™(è·å)
                        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .æ‰‹é§’(ç§»å‹•å…ˆã®é™£å–¶, è·å))
                    default:
                        throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£
                }
        }
    }
    enum ğŸš¨é§’ç§»å‹•ã‚¨ãƒ©ãƒ¼: Error {
        case ç„¡åŠ¹
    }
    func ã“ã“ã‹ã‚‰ã“ã“ã¸ã¯ç§»å‹•ä¸å¯(_ ç§»å‹•ã—å§‹ã‚ãŸå ´æ‰€: é§’ã®å ´æ‰€, _ ç§»å‹•å…ˆ: é§’ã®ç§»å‹•å…ˆãƒ‘ã‚¿ãƒ¼ãƒ³) -> Bool {
        guard ç§»å‹•ã—å§‹ã‚ãŸå ´æ‰€ != .ãªã— else { return true }
        switch ç§»å‹•å…ˆ {
            case .ç›¤ä¸Š(let æ¤œè¨¼ä½ç½®):
                switch ç§»å‹•ã—å§‹ã‚ãŸå ´æ‰€ {
                    case .ç›¤é§’(let ç›¤é§’ã®å…ƒã€…ã®ä½ç½®):
                        if æ¤œè¨¼ä½ç½® == ç›¤é§’ã®å…ƒã€…ã®ä½ç½® {
                            return true
                        }
                        if self.ç›¤é§’[æ¤œè¨¼ä½ç½®]?.é™£å–¶ == self.ç›¤é§’[ç›¤é§’ã®å…ƒã€…ã®ä½ç½®]?.é™£å–¶ {
                            return true
                        }
                        return false
                    case .æ‰‹é§’(_, _):
                        return self.ç›¤é§’[æ¤œè¨¼ä½ç½®] != nil
                    case .ãªã—:
                        assertionFailure(); return false
                }
            case .ç›¤å¤–(let ç§»å‹•ã—ãŸå…ˆã®é™£å–¶):
                switch ç§»å‹•ã—å§‹ã‚ãŸå ´æ‰€ {
                    case .ç›¤é§’(_):
                        return false
                    case .æ‰‹é§’(let å…ƒã€…ã®é™£å–¶, _):
                        return ç§»å‹•ã—ãŸå…ˆã®é™£å–¶ == å…ƒã€…ã®é™£å–¶
                    case .ãªã—:
                        assertionFailure(); return false
                }
        }
    }
    func ã“ã“ã«é§’ãŒã‚ã‚‹(_ å ´æ‰€: é§’ã®å ´æ‰€) -> Bool {
        switch å ´æ‰€ {
            case .ç›¤é§’(let ä½ç½®): return self.ç›¤é§’[ä½ç½®] != nil
            case .æ‰‹é§’(_, _): return self.ã“ã®æ‰‹é§’ã®æ•°(å ´æ‰€) > 0
            default: return false
        }
    }
    func ã“ã®é§’ã®è¡¨è¨˜(_ å ´æ‰€: é§’ã®å ´æ‰€, _ Englishè¡¨è¨˜: Bool) -> String? {
        guard let è·åè¡¨è¨˜ = self.ã“ã®é§’ã®è·åè¡¨è¨˜(å ´æ‰€, Englishè¡¨è¨˜) else { return nil }
        if case .æ‰‹é§’(_, _) = å ´æ‰€ {
            switch self.ã“ã®æ‰‹é§’ã®æ•°(å ´æ‰€) {
                case 1: return è·åè¡¨è¨˜
                case 2...: return è·åè¡¨è¨˜ + self.ã“ã®æ‰‹é§’ã®æ•°(å ´æ‰€).description
                default: return nil
            }
        } else {
            return è·åè¡¨è¨˜
        }
    }
    func ã“ã®é§’ã®è·åè¡¨è¨˜(_ å ´æ‰€: é§’ã®å ´æ‰€, _ Englishè¡¨è¨˜: Bool) -> String? {
        switch å ´æ‰€ {
            case .ç›¤é§’(let ä½ç½®):
                guard let é§’ = self.ç›¤é§’[ä½ç½®] else { return nil }
                if Englishè¡¨è¨˜ {
                    return é§’.æˆã‚Š ? é§’.è·å.Englishæˆé§’è¡¨è¨˜ : é§’.è·å.Englishç”Ÿé§’è¡¨è¨˜
                } else {
                    return é§’.æˆã‚Š ? é§’.è·å.æˆé§’è¡¨è¨˜ : é§’.è·å.ç”Ÿé§’è¡¨è¨˜(é§’.é™£å–¶)
                }
            case .æ‰‹é§’(let é™£å–¶, let è·å):
                if !Englishè¡¨è¨˜, é™£å–¶ == .ç‰å´, è·å == .ç‹ {
                    return "ç‰"
                } else {
                    return Englishè¡¨è¨˜ ? è·å.Englishç”Ÿé§’è¡¨è¨˜ : è·å.rawValue
                }
            case .ãªã—:
                return nil
        }
    }
    func ã“ã®é§’ã®é™£å–¶(_ å ´æ‰€: é§’ã®å ´æ‰€) -> ç‹å´ã‹ç‰å´ã‹? {
        switch å ´æ‰€ {
            case .ç›¤é§’(let ä½ç½®): return self.ç›¤é§’[ä½ç½®]?.é™£å–¶
            case .æ‰‹é§’(let ï½¼ï¾ï¾ï½´ï½², _): return ï½¼ï¾ï¾ï½´ï½²
            case .ãªã—: return nil
        }
    }
    func ã“ã‚Œã¨ã“ã‚Œã¯åŒã˜é™£å–¶(_ å ´æ‰€1: é§’ã®å ´æ‰€, _ å ´æ‰€2: é§’ã®å ´æ‰€) -> Bool {
        self.ã“ã®é§’ã®é™£å–¶(å ´æ‰€1) == self.ã“ã®é§’ã®é™£å–¶(å ´æ‰€2)
    }
    func ã“ã®æ‰‹é§’ã®æ•°(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) -> Int {
        self.æ‰‹é§’[é™£å–¶]?.å€‹æ•°(è·å) ?? 0
    }
    func ã“ã®æ‰‹é§’ã®æ•°(_ å ´æ‰€: é§’ã®å ´æ‰€) -> Int {
        switch å ´æ‰€ {
            case .æ‰‹é§’(let é™£å–¶, let è·å): return self.ã“ã®æ‰‹é§’ã®æ•°(é™£å–¶, è·å)
            default: assertionFailure(); return 0
        }
    }
    func ã“ã®é§’ã®é™£å–¶ã®æ‰‹é§’ã®ç¨®é¡ã®æ•°(_ å ´æ‰€: é§’ã®å ´æ‰€) -> Int {
        guard let é™£å–¶ = self.ã“ã®é§’ã®é™£å–¶(å ´æ‰€) else { return 0 }
        return é§’ã®ç¨®é¡.allCases.reduce(into: 0) {
            if self.ã“ã®æ‰‹é§’ã®æ•°(é™£å–¶, $1) > 0 { $0 += 1 }
        }
    }
    func ã“ã®é§’ã«ã¯ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ãŒå¿…è¦(_ å ´æ‰€: é§’ã®å ´æ‰€, _ Englishè¡¨è¨˜: Bool) -> Bool {
        guard Englishè¡¨è¨˜,
              case .ç›¤é§’(let ä½ç½®) = å ´æ‰€,
              let é§’ = self.ç›¤é§’[ä½ç½®],
              é§’.é™£å–¶ == .ç‰å´,
              [.éŠ€, .æ¡‚].contains(é§’.è·å) else { return false }
        return true
    }
    func ã“ã®é§’ç§»å‹•ã§æˆã‚‹äº‹ãŒå¯èƒ½(_ ç§»å‹•å¾Œã®å ´æ‰€: é§’ã®å ´æ‰€, _ å…ƒã€…ã®å ´æ‰€: é§’ã®å ´æ‰€) -> Bool {
        if case (.ç›¤é§’(let ç§»å‹•å…ˆ), .ç›¤é§’(let å…ƒã€…ã®ä½ç½®)) = (ç§»å‹•å¾Œã®å ´æ‰€, å…ƒã€…ã®å ´æ‰€) {
            if let ç§»å‹•å¾Œã®é§’ = self.ç›¤é§’[ç§»å‹•å…ˆ] {
                if ç§»å‹•å¾Œã®é§’.æˆã‚Š == false {
                    if ç§»å‹•å¾Œã®é§’.è·å.æˆé§’ã‚ã‚Š {
                        switch ç§»å‹•å¾Œã®é§’.é™£å–¶ {
                            case .ç‹å´:
                                if ç§»å‹•å…ˆ < 27 { return true }
                                if å…ƒã€…ã®ä½ç½® < 27 { return true }
                            case .ç‰å´:
                                if 53 < ç§»å‹•å…ˆ { return true }
                                if 53 < å…ƒã€…ã®ä½ç½® { return true }
                        }
                    }
                }
            }
        }
        return false
    }
    func ã“ã®é§’ã¯æˆã‚‹äº‹ãŒã§ãã‚‹(_ ä½ç½®: Int) -> Bool {
        self.ç›¤é§’[ä½ç½®]?.è·å.æˆé§’ã‚ã‚Š == true
    }
    mutating func ã“ã®é§’ã‚’è£è¿”ã™(_ ä½ç½®: Int) {
        if self.ã“ã®é§’ã¯æˆã‚‹äº‹ãŒã§ãã‚‹(ä½ç½®) {
            self.ç›¤é§’[ä½ç½®]?.è£è¿”ã™()
            self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ç›¤é§’(ä½ç½®))
        }
    }
    mutating func å¢—æ¸›ãƒ¢ãƒ¼ãƒ‰ã§ã“ã®æ‰‹é§’ã‚’ä¸€å€‹å¢—ã‚„ã™(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) {
        self.æ‰‹é§’[é™£å–¶]?.ä¸€å€‹å¢—ã‚„ã™(è·å)
        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .æ‰‹é§’(é™£å–¶, è·å))
    }
    mutating func å¢—æ¸›ãƒ¢ãƒ¼ãƒ‰ã§ã“ã®æ‰‹é§’ã‚’ä¸€å€‹æ¸›ã‚‰ã™(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) {
        if self.ã“ã®æ‰‹é§’ã®æ•°(.æ‰‹é§’(é™£å–¶, è·å)) >= 0 {
            self.æ‰‹é§’[é™£å–¶]?.ä¸€å€‹æ¸›ã‚‰ã™(è·å)
            self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .æ‰‹é§’(é™£å–¶, è·å))
        }
    }
    mutating func å¢—æ¸›ãƒ¢ãƒ¼ãƒ‰ã§ã“ã®ç›¤é§’ã‚’æ¶ˆã™(_ ä½ç½®: Int) {
        self.ç›¤é§’.removeValue(forKey: ä½ç½®)
        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ç›¤é§’(ä½ç½®))
    }
    mutating func ç›´è¿‘æ“ä½œæƒ…å ±ã‚’æ¶ˆã™() {
        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ãªã—)
    }
    mutating func åˆæœŸåŒ–ã™ã‚‹() {
        self = .åˆæœŸã‚»ãƒƒãƒˆ
        self.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: .ãªã—)
    }
    private mutating func ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œæ™‚ã®é›‘å¤šå‡¦ç†(å¼·èª¿å¯¾è±¡: é§’ã®å ´æ‰€) {
        self.ç›´è¿‘ã®æ“ä½œ = å¼·èª¿å¯¾è±¡
        self.æ›´æ–°æ—¥æ™‚ = .now
        self.ç¾åœ¨ã®å±€é¢ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹()
    }
    //SharePlayãƒ‡ãƒ¼ã‚¿å—ã‘å–ã‚Šæ™‚
    mutating func æ›´æ–°æ—¥æ™‚ã‚’å¤‰æ›´ã›ãšã«ãƒ¢ãƒ‡ãƒ«ã‚’é©ç”¨ã™ã‚‹(_ æ–°è¦å±€é¢: Self) {
        self = æ–°è¦å±€é¢
        self.ç¾åœ¨ã®å±€é¢ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹()
    }
    //å±¥æ­´å¾©å…ƒã‚„ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿é©ç”¨
    mutating func ç¾åœ¨ã®å±€é¢ã¨ã—ã¦é©ç”¨ã™ã‚‹(_ æ–°è¦å±€é¢: Self) {
        self = æ–°è¦å±€é¢
        self.æ›´æ–°æ—¥æ™‚ = .now
        self.ç¾åœ¨ã®å±€é¢ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹()
    }
    private func ç¾åœ¨ã®å±€é¢ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹() {
        var æ–°ã—ã„å±¥æ­´: [Self]
        æ–°ã—ã„å±¥æ­´ = Self.å±¥æ­´
        if æ–°ã—ã„å±¥æ­´.count > 30 { æ–°ã—ã„å±¥æ­´.removeFirst() }
        æ–°ã—ã„å±¥æ­´ += [self]
        do {
            let â““ata = try JSONEncoder().encode(æ–°ã—ã„å±¥æ­´)
            ğŸ’¾ICloud.set(â““ata, key: "å±¥æ­´")
            ğŸ’¾ICloud.synchronize()
        } catch {
            assertionFailure()
        }
    }
    static var å±¥æ­´: [Self] {
        guard let â““ata = ğŸ’¾ICloud.data(key: "å±¥æ­´") else { return [] }
        do {
            return try JSONDecoder().decode([Self].self, from: â““ata)
        } catch {
            assertionFailure(); return []
        }
    }
    static var å‰å›ã®å±€é¢: Self? { Self.å±¥æ­´.last }
    var ä¸€æ‰‹å‰ã®å±€é¢: Self? { Self.å±¥æ­´.last { $0.æ›´æ–°æ—¥æ™‚ != self.æ›´æ–°æ—¥æ™‚ } }
    static func å±¥æ­´ã‚’å…¨ã¦å‰Šé™¤ã™ã‚‹() { ğŸ’¾ICloud.remove(key: "å±¥æ­´") }
    func ç¾åœ¨ã®å±€é¢ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã™ã‚‹() { ğŸ’¾ICloud.set(self.ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰(), key: "ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯") }
    static func ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’èª­ã¿è¾¼ã‚€() -> Self? { .ãƒ‡ã‚³ãƒ¼ãƒ‰(ğŸ’¾ICloud.data(key: "ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯")) }
    func ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰() -> Data {
        do {
            return try JSONEncoder().encode(self)
        } catch {
            assertionFailure(); return Data()
        }
    }
    static func ãƒ‡ã‚³ãƒ¼ãƒ‰(_ ãƒ‡ãƒ¼ã‚¿: Data?) -> Self? {
        guard let ãƒ‡ãƒ¼ã‚¿ else { return nil }
        do {
            return try JSONDecoder().decode(Self.self, from: ãƒ‡ãƒ¼ã‚¿)
        } catch {
            assertionFailure(); return nil
        }
    }
    var æ›´æ–°æ—¥ä»˜è¡¨è¨˜: String { self.æ›´æ–°æ—¥æ™‚?.formatted(.dateTime.day().month()) ?? "ğŸ›" }
    var æ›´æ–°æ™‚åˆ»è¡¨è¨˜: String { self.æ›´æ–°æ—¥æ™‚?.formatted(.dateTime.hour().minute().second()) ?? "ğŸ›" }
    static var åˆæœŸã‚»ãƒƒãƒˆ: Self { Self(ç›¤é§’: åˆæœŸé…ç½®, æ‰‹é§’: ç©ºã®æ‰‹é§’) }
}

enum ç‹å´ã‹ç‰å´ã‹: String, CaseIterable, Codable {
    case ç‹å´, ç‰å´
}

struct ç›¤ä¸Šã®é§’: Codable {
    let é™£å–¶: ç‹å´ã‹ç‰å´ã‹
    let è·å: é§’ã®ç¨®é¡
    var æˆã‚Š: Bool
    mutating func è£è¿”ã™() {
        if self.è·å.æˆé§’ã‚ã‚Š { self.æˆã‚Š.toggle() }
    }
    init(_ ï½¼ï¾ï¾ï½´ï½²: ç‹å´ã‹ç‰å´ã‹, _ ï½¼ï½®ï½¸ï¾’ï½²: é§’ã®ç¨®é¡, _ ï¾…ï¾˜: Bool = false) {
        (self.é™£å–¶, self.è·å, self.æˆã‚Š) = (ï½¼ï¾ï¾ï½´ï½², ï½¼ï½®ï½¸ï¾’ï½², ï¾…ï¾˜)
    }
}

struct æŒã¡é§’: Codable {
    var é…åˆ†: [é§’ã®ç¨®é¡: Int] = [:]
    func å€‹æ•°(_ è·å: é§’ã®ç¨®é¡) -> Int { self.é…åˆ†[è·å] ?? 0 }
    static var ç©º: Self { Self(é…åˆ†: [:]) }
    mutating func ä¸€å€‹å¢—ã‚„ã™(_ è·å: é§’ã®ç¨®é¡) {
        self.é…åˆ†[è·å] = self.å€‹æ•°(è·å) + 1
    }
    mutating func ä¸€å€‹æ¸›ã‚‰ã™(_ è·å: é§’ã®ç¨®é¡) {
        if self.å€‹æ•°(è·å) >= 1 {
            self.é…åˆ†[è·å] = self.å€‹æ•°(è·å) - 1
        }
    }
}

enum é§’ã®å ´æ‰€: Codable, Equatable {
    case ç›¤é§’(_ ä½ç½®: Int)
    case æ‰‹é§’(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡)
    case ãªã—
}

enum é§’ã®ç§»å‹•å…ˆãƒ‘ã‚¿ãƒ¼ãƒ³ {
    case ç›¤ä¸Š(Int), ç›¤å¤–(ç‹å´ã‹ç‰å´ã‹)
}

enum æ‰‹å‰ã‹å¯¾é¢ã‹ {
    case æ‰‹å‰, å¯¾é¢
}

enum ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡: Equatable {
    case ã‚¢ãƒ—ãƒªå†…ã®é§’(é§’ã®å ´æ‰€)
    case ã‚¢ãƒ—ãƒªå¤–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    case ç„¡ã—
}

enum é§’ã®ç¨®é¡: String, CaseIterable, Identifiable, Codable {
    case æ­©, è§’, é£›, é¦™, æ¡‚, éŠ€, é‡‘, ç‹
    var id: Self { self }
    func ç”Ÿé§’è¡¨è¨˜(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹) -> String {
        if é™£å–¶ == .ç‰å´, self == .ç‹ {
            return "ç‰"
        } else {
            return self.rawValue
        }
    }
    var æˆé§’è¡¨è¨˜: String? {
        switch self {
            case .æ­©: return "ã¨"
            case .è§’: return "é¦¬"
            case .é£›: return "é¾"
            case .é¦™: return "æ"
            case .æ¡‚: return "åœ­"
            case .éŠ€: return "å…¨"
            default: return nil
        }
    }
    var æˆé§’ã‚ã‚Š: Bool { self.æˆé§’è¡¨è¨˜ != nil }
    var Englishç”Ÿé§’è¡¨è¨˜: String {
        switch self {
            case .æ­©: return "P"
            case .è§’: return "B"
            case .é£›: return "R"
            case .é¦™: return "L"
            case .æ¡‚: return "N"//è¦‹åˆ†ã‘ã‚‹ãŸã‚ã«ç›®å°ã‚’ä»˜ã‘ã‚‹å¿…è¦ã‚ã‚Š
            case .éŠ€: return "S"//è¦‹åˆ†ã‘ã‚‹ãŸã‚ã«ç›®å°ã‚’ä»˜ã‘ã‚‹å¿…è¦ã‚ã‚Š
            case .é‡‘: return "G"
            case .ç‹: return "K"
        }
    }
    var Englishæˆé§’è¡¨è¨˜: String? {
        switch self {
            case .æ­©: return "+P"
            case .è§’: return "+B"
            case .é£›: return "+R"
            case .é¦™: return "+L"
            case .æ¡‚: return "+N"
            case .éŠ€: return "+S"
            default: return nil
        }
    }
}


enum ğŸš¨ã‚¨ãƒ©ãƒ¼: Error {
    case è¦ä¿®æ­£
}




let ç©ºã®æ‰‹é§’: [ç‹å´ã‹ç‰å´ã‹: æŒã¡é§’] = [.ç‹å´: æŒã¡é§’.ç©º, .ç‰å´: æŒã¡é§’.ç©º]

private let åˆæœŸé…ç½®: [Int: ç›¤ä¸Šã®é§’] = {
    var é…ç½®: [Int: ç›¤ä¸Šã®é§’] = [:]
    
    let ãƒ†ãƒ³ãƒ—ãƒ¬: [Int: (ç‹å´ã‹ç‰å´ã‹, é§’ã®ç¨®é¡)] =
    [00:(.ç‰å´,.é¦™),01:(.ç‰å´,.æ¡‚),02:(.ç‰å´,.éŠ€),03:(.ç‰å´,.é‡‘),04:(.ç‰å´,.ç‹),05:(.ç‰å´,.é‡‘),06:(.ç‰å´,.éŠ€),07:(.ç‰å´,.æ¡‚),08:(.ç‰å´,.é¦™),
                   10:(.ç‰å´,.é£›),                                                                     16:(.ç‰å´,.è§’),
     18:(.ç‰å´,.æ­©),19:(.ç‰å´,.æ­©),20:(.ç‰å´,.æ­©),21:(.ç‰å´,.æ­©),22:(.ç‰å´,.æ­©),23:(.ç‰å´,.æ­©),24:(.ç‰å´,.æ­©),25:(.ç‰å´,.æ­©),26:(.ç‰å´,.æ­©),
     
     54:(.ç‹å´,.æ­©),55:(.ç‹å´,.æ­©),56:(.ç‹å´,.æ­©),57:(.ç‹å´,.æ­©),58:(.ç‹å´,.æ­©),59:(.ç‹å´,.æ­©),60:(.ç‹å´,.æ­©),61:(.ç‹å´,.æ­©),62:(.ç‹å´,.æ­©),
                   64:(.ç‹å´,.è§’),                                                                     70:(.ç‹å´,.é£›),
     72:(.ç‹å´,.é¦™),73:(.ç‹å´,.æ¡‚),74:(.ç‹å´,.éŠ€),75:(.ç‹å´,.é‡‘),76:(.ç‹å´,.ç‹),77:(.ç‹å´,.é‡‘),78:(.ç‹å´,.éŠ€),79:(.ç‹å´,.æ¡‚),80:(.ç‹å´,.é¦™)]
    
    
    ãƒ†ãƒ³ãƒ—ãƒ¬.forEach { (ä½ç½®: Int, é§’: (é™£å–¶: ç‹å´ã‹ç‰å´ã‹, è·å: é§’ã®ç¨®é¡)) in
        é…ç½®[ä½ç½®] = ç›¤ä¸Šã®é§’(é§’.é™£å–¶, é§’.è·å)
    }
    
    return é…ç½®
}()
