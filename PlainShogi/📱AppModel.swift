import Combine
import SwiftUI
import UniformTypeIdentifiers

@MainActor
class ğŸ“±ã‚¢ãƒ—ãƒªãƒ¢ãƒ‡ãƒ«: ObservableObject {
    
    @Published private(set) var å±€é¢: å±€é¢ãƒ¢ãƒ‡ãƒ«
    
    @AppStorage("Englishè¡¨è¨˜") var ğŸš©Englishè¡¨è¨˜: Bool = false
    @AppStorage("ç§»å‹•ç›´å¾Œå¼·èª¿è¡¨ç¤ºæ©Ÿèƒ½ã‚ªãƒ•") var ğŸš©ç§»å‹•ç›´å¾Œå¼·èª¿è¡¨ç¤ºæ©Ÿèƒ½ã‚ªãƒ•: Bool = false
    @AppStorage("ä¸Šä¸‹åè»¢") var ğŸš©ä¸Šä¸‹åè»¢: Bool = false
    
    @Published var ğŸš©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º: Bool = false
    @Published var ğŸš©é§’ã‚’æ•´ç†ä¸­: Bool = false
    
    @Published var ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½®: Int? = nil
    private var ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’: ç›¤å¤–ã®é§’? = nil
    
    var ç¾çŠ¶: ãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ³ = .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„ {
        didSet {
            switch ç¾çŠ¶ {
                case .ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ = nil
                case .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® = nil
                case .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹, .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„:
                    ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® = nil
                    ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ = nil
            }
        }
    }
    
    func ã“ã®ç›¤ä¸Šã®é§’ã®è¡¨è¨˜(_ ä½ç½®: Int) -> String {
        guard let é§’ = self.å±€é¢.ç›¤é§’[ä½ç½®] else { return "ğŸ›" }
        let ã‚·ãƒ³ãƒœãƒ«: String
        if é§’.æˆã‚Š {
            if self.ğŸš©Englishè¡¨è¨˜ {
                ã‚·ãƒ³ãƒœãƒ« = é§’.è·å.Englishæˆé§’è¡¨è¨˜ ?? "ğŸ›"
            } else {
                ã‚·ãƒ³ãƒœãƒ« = é§’.è·å.æˆé§’è¡¨è¨˜ ?? "ğŸ›"
            }
        } else {
            if !self.ğŸš©Englishè¡¨è¨˜ && (é§’.é™£å–¶ == .ç‰å´) && (é§’.è·å == .ç‹) {
                ã‚·ãƒ³ãƒœãƒ« = "ç‰"
            } else {
                if self.ğŸš©Englishè¡¨è¨˜ {
                    ã‚·ãƒ³ãƒœãƒ« = é§’.è·å.Englishç”Ÿé§’è¡¨è¨˜
                } else {
                    ã‚·ãƒ³ãƒœãƒ« = é§’.è·å.rawValue
                }
            }
        }
        if self.ğŸš©Englishè¡¨è¨˜ && (é§’.é™£å–¶ == .ç‰å´) && (é§’.è·å == .éŠ€ || é§’.è·å == .æ¡‚) {
            return ã‚·ãƒ³ãƒœãƒ« + "â€²" // U+2032 PRIME
        } else {
            return ã‚·ãƒ³ãƒœãƒ«
        }
    }
    
    func ã“ã®æŒã¡é§’ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) -> (é§’ã®è¡¨è¨˜: String, æ•°: Int, æ•°ã®è¡¨è¨˜: String) {
        var é§’ã®è¡¨è¨˜: String
        if !self.ğŸš©Englishè¡¨è¨˜ && (é™£å–¶ == .ç‰å´) && (è·å == .ç‹) {
            é§’ã®è¡¨è¨˜ = "ç‰"
        } else {
            é§’ã®è¡¨è¨˜ = self.ğŸš©Englishè¡¨è¨˜ ? è·å.Englishç”Ÿé§’è¡¨è¨˜ : è·å.rawValue
        }
        let æ•°: Int = self.å±€é¢.æ‰‹é§’[é™£å–¶]?.å€‹æ•°(è·å) ?? 0
        let æ•°ã®è¡¨è¨˜: String = æ•° >= 2 ? æ•°.description : ""
        if !self.ğŸš©ç§»å‹•ç›´å¾Œå¼·èª¿è¡¨ç¤ºæ©Ÿèƒ½ã‚ªãƒ• {
            if let å¼·èª¿ã™ã‚‹æŒã¡é§’ = self.å±€é¢.ç›¤é§’ã®é€šå¸¸ç§»å‹•ç›´å¾Œã®é§’?.å–ã£ãŸæŒã¡é§’ {
                if let ç§»å‹•ç›´å¾Œã®ä½ç½® = self.å±€é¢.ç›¤é§’ã®é€šå¸¸ç§»å‹•ç›´å¾Œã®é§’?.ç›¤ä¸Šã®ä½ç½® {
                    if é™£å–¶ == self.å±€é¢.ç›¤é§’[ç§»å‹•ç›´å¾Œã®ä½ç½®]?.é™£å–¶ {
                        if è·å == å¼·èª¿ã™ã‚‹æŒã¡é§’ {
                            é§’ã®è¡¨è¨˜ += "ï¸­"
                        }
                    }
                }
            }
        }
        return (é§’ã®è¡¨è¨˜, æ•°, æ•°ã®è¡¨è¨˜)
    }
    
    func ã“ã®ã‚³ãƒã¯é€šå¸¸ç§»å‹•ç›´å¾Œ(_ ç”»é¢ä¸Šã§ã®å·¦ä¸Šã‹ã‚‰ã®ä½ç½®: Int) -> Bool {
        let å…ƒã€…ã®ä½ç½® = self.ğŸš©ä¸Šä¸‹åè»¢ ? (80 - ç”»é¢ä¸Šã§ã®å·¦ä¸Šã‹ã‚‰ã®ä½ç½®) : ç”»é¢ä¸Šã§ã®å·¦ä¸Šã‹ã‚‰ã®ä½ç½®
        return self.å±€é¢.ç›¤é§’ã®é€šå¸¸ç§»å‹•ç›´å¾Œã®é§’?.ç›¤ä¸Šã®ä½ç½® == å…ƒã€…ã®ä½ç½®
    }
    
    func ã“ã®è¡Œã®ã‚³ãƒã¯é€šå¸¸ç§»å‹•ç›´å¾Œ(_ è¡Œ: Int) -> Bool {
        if let é§’ = self.å±€é¢.ç›¤é§’ã®é€šå¸¸ç§»å‹•ç›´å¾Œã®é§’ {
            let ç”»é¢ä¸Šã®ä½ç½® = self.ğŸš©ä¸Šä¸‹åè»¢ ? (80 - é§’.ç›¤ä¸Šã®ä½ç½®) : é§’.ç›¤ä¸Šã®ä½ç½®
            return è¡Œ == ç”»é¢ä¸Šã®ä½ç½® / 9
        } else {
            return false
        }
    }
    
    func ç›¤é§’ã®é€šå¸¸ç§»å‹•ç›´å¾Œã®å¼·èª¿è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢() {
        self.å±€é¢.ç›¤é§’é€šå¸¸ç§»å‹•ç›´å¾Œæƒ…å ±ã‚’æ¶ˆã™()
        æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯()
    }
    
    func ã“ã®é§’ã‚’è£è¿”ã™(_ ä½ç½®: Int) {
        if self.å±€é¢.ç›¤é§’[ä½ç½®]?.æˆã‚Š != nil {
            self.å±€é¢.ã“ã®é§’ã‚’è£è¿”ã™(ä½ç½®)
            self.ãƒ­ã‚°ã‚’æ›´æ–°ã™ã‚‹()
            UIImpactFeedbackGenerator(style: .light).impactOccurred()
        }
    }

    func ç›¤é¢ã‚’åˆæœŸåŒ–ã™ã‚‹() {
        self.å±€é¢.åˆæœŸåŒ–ã™ã‚‹()
        UINotificationFeedbackGenerator().notificationOccurred(.error)
    }

    func ã“ã®æ‰‹é§’ã‚’ä¸€å€‹å¢—ã‚„ã™(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) {
        self.å±€é¢.ã“ã®æ‰‹é§’ã‚’ä¸€å€‹å¢—ã‚„ã™(é™£å–¶, è·å)
        æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯()
    }

    func ã“ã®æ‰‹é§’ã‚’ä¸€å€‹æ¸›ã‚‰ã™(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) {
        self.å±€é¢.ã“ã®æ‰‹é§’ã‚’ä¸€å€‹æ¸›ã‚‰ã™(é™£å–¶, è·å)
        æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯()
    }

    func ã“ã®ç›¤é§’ã‚’æ¶ˆã™(_ ä½ç½®: Int) {
        self.å±€é¢.ã“ã®ç›¤é§’ã‚’æ¶ˆã™(ä½ç½®)
        æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯()
    }
    
    // ======== ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç† ========
    func ã“ã®ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—å§‹ã‚ã‚‹(_ ä½ç½®: Int) -> NSItemProvider {
        self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® = ä½ç½®
        self.ç¾çŠ¶ = .ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹
        return self.ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡ã¨ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”¨æ„ã™ã‚‹()
    }
    
    func ã“ã®æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—å§‹ã‚ã‚‹(_ é™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ è·å: é§’ã®ç¨®é¡) -> NSItemProvider {
        self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ = ç›¤å¤–ã®é§’(é™£å–¶, è·å)
        self.ç¾çŠ¶ = .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹
        return self.ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡ã¨ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”¨æ„ã™ã‚‹()
    }
    
    private func ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡ã¨ãªã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”¨æ„ã™ã‚‹() -> NSItemProvider {
        let ãƒ†ã‚­ã‚¹ãƒˆ = self.ç¾åœ¨ã®ç›¤é¢ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹()
        let â“˜temProvider = NSItemProvider(object: ãƒ†ã‚­ã‚¹ãƒˆ as NSItemProviderWriting)
        â“˜temProvider.suggestedName = "ã‚¢ãƒ—ãƒªå†…ã§ã®ã‚³ãƒç§»å‹•"
        return â“˜temProvider
    }
    
    // ================================================================================
    // ============================= ä»¥ä¸‹ã€ãƒ‰ãƒ­ãƒƒãƒ—Delegate =============================
    func ç›¤ä¸Šã®ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹(_ ç½®ã„ãŸä½ç½®: Int, _ â“˜nfo: DropInfo) -> Bool {
        do {
            switch self.ç¾çŠ¶ {
                case .ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    guard let å‡ºç™ºåœ°ç‚¹ = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                    try self.å±€é¢.ç›¤é§’ã‚’ç§»å‹•ã•ã›ã‚‹(å‡ºç™ºåœ°ç‚¹, ç½®ã„ãŸä½ç½®)
                    self.é§’ã‚’ç§»å‹•ã—çµ‚ã‚ã£ãŸã‚‰ãƒ­ã‚°ã‚’æ›´æ–°ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹()
                case .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    guard let é§’ = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                    try self.å±€é¢.æŒã¡é§’ã‚’ç›¤ä¸Šã¸ç§»å‹•ã•ã›ã‚‹(é§’, ç½®ã„ãŸä½ç½®)
                    self.é§’ã‚’ç§»å‹•ã—çµ‚ã‚ã£ãŸã‚‰ãƒ­ã‚°ã‚’æ›´æ–°ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹()
                case .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    let â“˜temProviders = â“˜nfo.itemProviders(for: [UTType.utf8PlainText])
                    self.ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç›¤é¢ã«åæ˜ ã™ã‚‹(â“˜temProviders)
                case .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„:
                    return false
            }
            return true
        } catch å±€é¢ãƒ¢ãƒ‡ãƒ«.ğŸš¨é§’ç§»å‹•ã‚¨ãƒ©ãƒ¼.ç„¡åŠ¹ {
            return false
        } catch {
            print("ğŸš¨", error.localizedDescription)
            assertionFailure()
            return false
        }
    }
    
    func ç›¤å¤–ã®ã“ã¡ã‚‰å´ã«ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹(_ ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸé™£å–¶: ç‹å´ã‹ç‰å´ã‹, _ â“˜nfo: DropInfo) -> Bool {
        do {
            switch self.ç¾çŠ¶ {
                case .ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    guard let å‡ºç™ºåœ°ç‚¹ = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                    try self.å±€é¢.ç›¤é§’ã‚’ç›¤å¤–ã¸ç§»å‹•ã•ã›ã‚‹(å‡ºç™ºåœ°ç‚¹, ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸé™£å–¶)
                    self.é§’ã‚’ç§»å‹•ã—çµ‚ã‚ã£ãŸã‚‰ãƒ­ã‚°ã‚’æ›´æ–°ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹()
                case .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    guard let é§’ = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ else { throw ğŸš¨ã‚¨ãƒ©ãƒ¼.è¦ä¿®æ­£ }
                    self.å±€é¢.æŒã¡é§’ã‚’æ•µã®æŒã¡é§’ã«ç§»å‹•ã•ã›ã‚‹(é§’, ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸé™£å–¶)
                    self.é§’ã‚’ç§»å‹•ã—çµ‚ã‚ã£ãŸã‚‰ãƒ­ã‚°ã‚’æ›´æ–°ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹()
                case .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                    let â“˜temProviders = â“˜nfo.itemProviders(for: [UTType.utf8PlainText])
                    self.ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç›¤é¢ã«åæ˜ ã™ã‚‹(â“˜temProviders)
                case .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„:
                    return false
            }
            return true
        } catch {
            print("ğŸš¨", error.localizedDescription)
            assertionFailure()
            return false
        }
    }
    
    private func é§’ã‚’ç§»å‹•ã—çµ‚ã‚ã£ãŸã‚‰ãƒ­ã‚°ã‚’æ›´æ–°ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç™ºç”Ÿã•ã›ã‚‹() {
        self.ç¾çŠ¶ = .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„
        self.ãƒ­ã‚°ã‚’æ›´æ–°ã™ã‚‹()
        UIImpactFeedbackGenerator(style: .soft).impactOccurred()
    }
    
    func ç›¤ä¸Šã®ã“ã“ã¯ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ã‹ç¢ºèªã™ã‚‹(_ ä½ç½®: Int) -> DropProposal? {
        switch self.ç¾çŠ¶ {
            case .ç›¤ä¸Šã®é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                if ä½ç½® == self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® {
                    return DropProposal(operation: .cancel)
                }
                if let å…ƒã€…ã®ä½ç½® = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸç›¤ä¸Šã®é§’ã®å…ƒã€…ã®ä½ç½® {
                    if self.å±€é¢.ç›¤é§’[ä½ç½®]?.é™£å–¶ == self.å±€é¢.ç›¤é§’[å…ƒã€…ã®ä½ç½®]?.é™£å–¶ {
                        return DropProposal(operation: .cancel)
                    }
                }
            case .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹:
                if self.å±€é¢.ç›¤é§’[ä½ç½®] != nil {
                    return .init(operation: .cancel)
                }
            case .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹, .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„:
                return nil
        }
        return nil
    }
    
    func ç›¤å¤–ã®ã“ã“ã¯ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ã‹ç¢ºèªã™ã‚‹(_ ãƒ‰ãƒ­ãƒƒãƒ—ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹é™£å–¶: ç‹å´ã‹ç‰å´ã‹) -> DropProposal? {
        if self.ç¾çŠ¶ == .æŒã¡é§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹ {
            if let é§’ = self.ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸæŒã¡é§’ {
                if ãƒ‰ãƒ­ãƒƒãƒ—ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹é™£å–¶ == é§’.é™£å–¶ {
                    return DropProposal(operation: .cancel)
                }
            }
        }
        return nil
    }
        
    func æœ‰åŠ¹ãªãƒ‰ãƒ­ãƒƒãƒ—ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹(_ â“˜nfo: DropInfo) -> Bool {
        let â“˜temProviders = â“˜nfo.itemProviders(for: [UTType.utf8PlainText])
        guard let â“˜temProvider = â“˜temProviders.first else { return false }
        if let â“¢uggestedName = â“˜temProvider.suggestedName {
            if â“¢uggestedName != "ã‚¢ãƒ—ãƒªå†…ã§ã®ã‚³ãƒç§»å‹•" {
                print("ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã§ã™")
                print("itemProvider.suggestedName: ", â“¢uggestedName)
                self.ç¾çŠ¶ = .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹
            }
        } else {
            print("ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ã®ã‚¢ã‚¤ãƒ†ãƒ ã§ã™")
            self.ç¾çŠ¶ = .ã‚¢ãƒ—ãƒªå¤–éƒ¨ã‹ã‚‰ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã„ã‚‹
        }
        return true
    }
    
    // ==============================================================================
    // ============================= ä»¥ä¸‹ã€ãƒ­ã‚°ã®æ›´æ–°ã‚„ä¿å­˜ =============================
    init() {
        if ãƒ‡ãƒ¼ã‚¿ç®¡ç†_ver_3_0_2.ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ {
            self.å±€é¢ = ãƒ‡ãƒ¼ã‚¿ç®¡ç†_ver_3_0_2.ä»¥å‰ã‚¢ãƒ—ãƒªèµ·å‹•ã—ãŸéš›ã®ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã‚€()
            ãƒ‡ãƒ¼ã‚¿ç®¡ç†_ver_3_0_2.ä»¥å‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã™ã‚‹()
        } else {
            if let å‰å›ã®å±€é¢ = å±€é¢ãƒ¢ãƒ‡ãƒ«.å±¥æ­´.last {
                self.å±€é¢ = å‰å›ã®å±€é¢
            } else {
                self.å±€é¢ = .åˆæœŸã‚»ãƒƒãƒˆ
            }
        }
    }
    
    private func ãƒ­ã‚°ã‚’æ›´æ–°ã™ã‚‹() {//MARK: WIP
        self.å±€é¢.ç¾åœ¨ã®å±€é¢ã‚’å±¥æ­´ã«è¿½åŠ ã™ã‚‹()
    }
    
    // ==============================================================================
    // ======================== ä»¥ä¸‹ã€ãƒ†ã‚­ã‚¹ãƒˆæ›¸ãå‡ºã—èª­ã¿è¾¼ã¿æ©Ÿèƒ½ ========================
    func ç¾åœ¨ã®ç›¤é¢ã‚’ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹() -> String {
        ğŸ“ƒãƒ†ã‚­ã‚¹ãƒˆé€£æºæ©Ÿèƒ½.ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹(self.å±€é¢)
    }
    
    private func ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç›¤é¢ã«åæ˜ ã™ã‚‹(_ â“˜temProviders: [NSItemProvider]) {
        Task { @MainActor in
            do {
                guard let â“˜temProvider = â“˜temProviders.first else { return }
                let â“¢ecureCodingObject = try await â“˜temProvider.loadItem(forTypeIdentifier: UTType.utf8PlainText.identifier)
                guard let ãƒ‡ãƒ¼ã‚¿ = â“¢ecureCodingObject as? Data else { return }
                guard let ãƒ†ã‚­ã‚¹ãƒˆ = String(data: ãƒ‡ãƒ¼ã‚¿, encoding: .utf8) else { return }
                if let ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸå±€é¢ = ğŸ“ƒãƒ†ã‚­ã‚¹ãƒˆé€£æºæ©Ÿèƒ½.å±€é¢ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹(ãƒ†ã‚­ã‚¹ãƒˆ) {
                    self.å±€é¢ = ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸå±€é¢
                    UINotificationFeedbackGenerator().notificationOccurred(.success)
                }
                self.ç¾çŠ¶ = .ä½•ã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ãªã„
            } catch {
                print(#function, error)
            }
        }
    }
}

enum ğŸš¨ã‚¨ãƒ©ãƒ¼: Error {
    case è¦ä¿®æ­£
}
