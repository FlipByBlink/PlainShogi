import Foundation

struct ğŸ“ƒãƒ†ã‚­ã‚¹ãƒˆé€£æºæ©Ÿèƒ½ {
    static func ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã™ã‚‹(_ å±€é¢: å±€é¢ãƒ¢ãƒ‡ãƒ«) -> String {
        let ğŸš©Englishè¡¨è¨˜ = UserDefaults.standard.bool(forKey: "Englishè¡¨è¨˜")
        var ğŸ“ƒ = "â˜—"
        
        é§’ã®ç¨®é¡.allCases.forEach { è·å in
            if let æ•° = å±€é¢.æ‰‹é§’[.ç‰å´]?.å€‹æ•°(è·å) {
                if æ•° >= 1 {
                    ğŸ“ƒ += ğŸš©Englishè¡¨è¨˜ ? Self.é§’ã‚’Englishãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›(è·å) : è·å.rawValue
                    ğŸ“ƒ += "Í™"
                }
                
                if æ•° >= 2 {
                    ğŸ“ƒ += æ•°.description
                }
            }
        }
        
        ğŸ“ƒ += "\nï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\n"
        
        for è¡Œ in 0 ..< 9 {
            for åˆ— in 0 ..< 9 {
                if let é§’ = å±€é¢.ç›¤é§’[è¡Œ * 9 + åˆ—] {
                    if ğŸš©Englishè¡¨è¨˜ {
                        ğŸ“ƒ += Self.é§’ã‚’Englishãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›(é§’.è·å, é§’.æˆã‚Š)
                    } else {
                        ğŸ“ƒ += é§’.æˆã‚Š ? é§’.è·å.æˆé§’è¡¨è¨˜! : é§’.è·å.rawValue
                    }
                    
                    if é§’.é™£å–¶ == .ç‰å´ {
                        ğŸ“ƒ += "Í™"
                    }
                } else {
                    ğŸ“ƒ += "ã€€"
                }
            }
            ğŸ“ƒ += "\n"
        }
        
        ğŸ“ƒ += "ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\nâ˜–"
        
        é§’ã®ç¨®é¡.allCases.forEach { è·å in
            if let æ•° = å±€é¢.æ‰‹é§’[.ç‹å´]?.å€‹æ•°(è·å) {
                if æ•° >= 1 {
                    ğŸ“ƒ += ğŸš©Englishè¡¨è¨˜ ? Self.é§’ã‚’Englishãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›(è·å) : è·å.rawValue
                }
                
                if æ•° >= 2 {
                    ğŸ“ƒ += æ•°.description
                }
            }
        }
        
        return ğŸ“ƒ
    }
    
    static func å±€é¢ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›ã™ã‚‹(_ ãƒ†ã‚­ã‚¹ãƒˆ: String) -> å±€é¢ãƒ¢ãƒ‡ãƒ«? {
        guard ãƒ†ã‚­ã‚¹ãƒˆ.first == "â˜—" else {
            print("å…ˆé ­ã®æ–‡å­—ãŒã€Œâ˜—ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚")
            return nil
        }
        
        var ç›¤é§’: [Int: ç›¤ä¸Šã®é§’] = [:]
        var æ‰‹é§’: [ç‹å´ã‹ç‰å´ã‹: æŒã¡é§’] = ç©ºã®æ‰‹é§’
        var æ”¹è¡Œæ•°: Int = 0
        var åˆ—: Int = 0
        var èª­ã¿è¾¼ã¿ä¸­ã®æ‰‹é§’ã®ç¨®é¡: é§’ã®ç¨®é¡ = .æ­©
        
        for å­—åŒºåˆ‡ã‚Š in ãƒ†ã‚­ã‚¹ãƒˆ {
            if å­—åŒºåˆ‡ã‚Š == "\n" {
                æ”¹è¡Œæ•° += 1
                åˆ— = 0
                continue
            }
            
            let é§’ãƒ†ã‚­ã‚¹ãƒˆ = å­—åŒºåˆ‡ã‚Š.description
            
            switch æ”¹è¡Œæ•° {
                case 0:
                    if let æ•° = Int(é§’ãƒ†ã‚­ã‚¹ãƒˆ) {
                        æ‰‹é§’[.ç‰å´]?.é…åˆ†[èª­ã¿è¾¼ã¿ä¸­ã®æ‰‹é§’ã®ç¨®é¡] = æ•°
                    } else {
                        if let é§’ = Self.ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é§’ã«å¤‰æ›(é§’ãƒ†ã‚­ã‚¹ãƒˆ) {
                            æ‰‹é§’[é§’.é™£å–¶]?.é…åˆ†[é§’.è·å] = 1
                            
                            èª­ã¿è¾¼ã¿ä¸­ã®æ‰‹é§’ã®ç¨®é¡ = é§’.è·å
                        }
                    }
                case 1...11:
                    let ä½ç½® = ( æ”¹è¡Œæ•° - 2 ) * 9 + åˆ—
                    
                    if let é§’ = Self.ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é§’ã«å¤‰æ›(é§’ãƒ†ã‚­ã‚¹ãƒˆ) {
                        ç›¤é§’.updateValue(ç›¤ä¸Šã®é§’(é§’.é™£å–¶, é§’.è·å, é§’.æˆã‚Š), forKey: ä½ç½®)
                    }
                case 12:
                    if let æ•° = Int(é§’ãƒ†ã‚­ã‚¹ãƒˆ) {
                        æ‰‹é§’[.ç‹å´]?.é…åˆ†[èª­ã¿è¾¼ã¿ä¸­ã®æ‰‹é§’ã®ç¨®é¡] = æ•°
                    } else {
                        if let é§’ = Self.ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é§’ã«å¤‰æ›(é§’ãƒ†ã‚­ã‚¹ãƒˆ) {
                            æ‰‹é§’[é§’.é™£å–¶]?.é…åˆ†[é§’.è·å] = 1
                            
                            èª­ã¿è¾¼ã¿ä¸­ã®æ‰‹é§’ã®ç¨®é¡ = é§’.è·å
                        }
                    }
                default: break
            }
            
            åˆ— += 1
        }
        
        return å±€é¢ãƒ¢ãƒ‡ãƒ«(ç›¤é§’: ç›¤é§’, æ‰‹é§’: æ‰‹é§’)
    }
    
    private static func é§’ã‚’Englishãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›(_ è·å: é§’ã®ç¨®é¡, _ æˆã‚Š: Bool = false) -> String {
        switch è·å {
            case .æ­©: return æˆã‚Š ? "ï½" : "ï¼°"
            case .è§’: return æˆã‚Š ? "ï½‚" : "ï¼¢"
            case .é£›: return æˆã‚Š ? "ï½’" : "ï¼²"
            case .é¦™: return æˆã‚Š ? "ï½Œ" : "ï¼¬"
            case .æ¡‚: return æˆã‚Š ? "ï½" : "ï¼®"
            case .éŠ€: return æˆã‚Š ? "ï½“" : "ï¼³"
            case .é‡‘: return "ï¼§"
            case .ç‹: return "ï¼«"
        }
    }
    
    private static func ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é§’ã«å¤‰æ›(_ ãƒ†ã‚­ã‚¹ãƒˆ: String) -> (é™£å–¶: ç‹å´ã‹ç‰å´ã‹, è·å: é§’ã®ç¨®é¡, æˆã‚Š: Bool)? {
        var é™£å–¶: ç‹å´ã‹ç‰å´ã‹ = .ç‹å´
        var è·å: é§’ã®ç¨®é¡ = .æ­©
        var æˆã‚Š = false
        
        if ãƒ†ã‚­ã‚¹ãƒˆ.unicodeScalars.contains("Í™") { é™£å–¶ = .ç‰å´ }
        
        if let è·åãƒ†ã‚­ã‚¹ãƒˆ = ãƒ†ã‚­ã‚¹ãƒˆ.unicodeScalars.first?.description {
            switch è·åãƒ†ã‚­ã‚¹ãƒˆ {
                case "æ­©","ï¼°": è·å = .æ­©
                case "è§’","ï¼¢": è·å = .è§’
                case "é£›","ï¼²": è·å = .é£›
                case "é¦™","ï¼¬": è·å = .é¦™
                case "æ¡‚","ï¼®": è·å = .æ¡‚
                case "éŠ€","ï¼³": è·å = .éŠ€
                case "é‡‘","ï¼§": è·å = .é‡‘
                case "ç‹","ç‰","ï¼«": è·å = .ç‹
                case "ã¨","ï½": (è·å, æˆã‚Š) = (.æ­©, true)
                case "é¦¬","ï½‚": (è·å, æˆã‚Š) = (.è§’, true)
                case "é¾","ï½’": (è·å, æˆã‚Š) = (.é£›, true)
                case "æ","ï½Œ": (è·å, æˆã‚Š) = (.é¦™, true)
                case "åœ­","ï½": (è·å, æˆã‚Š) = (.æ¡‚, true)
                case "å…¨","ï½“": (è·å, æˆã‚Š) = (.éŠ€, true)
                default: return nil
            }
        }
        
        return (é™£å–¶, è·å, æˆã‚Š)
    }
}
